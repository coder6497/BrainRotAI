<!DOCTYPE html>

<html>
    <head>
        <title>BrainRotAI</title>
    </head>
    <body>
        <h1>BrainRotAI</h1>
        <h3>Generate image by prompt</h3>
        <form id="prompt_form" method="post">
            Prompt: <input type="text" id="prompt_input">
            <br><br>
            <button type="submit" id="submit_btn">Generate</button>
        </form>
        <br>
        <div id="result_image"></div>
    </body>
    <script>
        let button_change = function(btn, state) {
            switch (state) {
                case "loading":
                    btn.disabled = true;
                    btn.style.opacity = "0.7";
                    btn.innerHTML = "Generating...";
                    break;
                case "done":
                    btn.disabled = false;
                    btn.style.opacity = "1";
                    btn.innerHTML = "Generate";
                    break;
            }

        }

        let generate_form = document.getElementById("prompt_form");
        let submit_btn = document.getElementById("submit_btn");
    
        generate_form.onsubmit = async (e) => {
            e.preventDefault();
            button_change(submit_btn, "loading");

            let prompt_text = document.getElementById("prompt_input").value;
            try {
                let response = await fetch(`http://127.0.0.1:8000/generate/`, {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({"prompt": prompt_text})
                });
                let response_result = await response.json()
                document.getElementById("result_image").innerHTML = `
                <img src="data:image/png;base64,${response_result.result}" width="400"/>
                <br>
                <button type="submit" id="clear_button" onclick="clear_result()">Clear</button>
                `
            }
            finally {
                button_change(submit_btn, "done");
            }
        };
        
        let clear_result = function() {
            document.getElementById("result_image").innerHTML = "";
        }

    </script>
</html>